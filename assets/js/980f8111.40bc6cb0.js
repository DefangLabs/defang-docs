"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[3249],{2251:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var t=i(4848),o=i(8453);const r={title:"Deploy Using Pulumi",sidebar_position:400},l="Deploy Using Pulumi",s={id:"tutorials/deploy-using-pulumi",title:"Deploy Using Pulumi",description:"At the time of writing, the Defang Pulumi Provider only works with Defang Playground. We are working on BYOC support.",source:"@site/docs/tutorials/deploy-using-pulumi.mdx",sourceDirName:"tutorials",slug:"/tutorials/deploy-using-pulumi",permalink:"/docs/tutorials/deploy-using-pulumi",draft:!1,unlisted:!1,editUrl:"https://github.com/DefangLabs/defang-docs/tree/main/docs/tutorials/deploy-using-pulumi.mdx",tags:[],version:"current",sidebarPosition:400,frontMatter:{title:"Deploy Using Pulumi",sidebar_position:400},sidebar:"docsSidebar",previous:{title:"Configure Environment Variables",permalink:"/docs/tutorials/configure-environment-variables"},next:{title:"Monitoring Your Services",permalink:"/docs/tutorials/monitoring-your-services"}},a={},c=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Step 1 - Authenticate With Defang",id:"step-1---authenticate-with-defang",level:2},{value:"Step 2 - Configure the Pulumi Backend",id:"step-2---configure-the-pulumi-backend",level:2},{value:"Step 3 - Initialize the Pulumi Project",id:"step-3---initialize-the-pulumi-project",level:2},{value:"Step 4 - Write Your Pulumi Code",id:"step-4---write-your-pulumi-code",level:2},{value:"Step 5 - Deploy to Defang",id:"step-5---deploy-to-defang",level:2},{value:"Step 6 - Monitor the Deployment",id:"step-6---monitor-the-deployment",level:2},{value:"Logging Into Minio",id:"logging-into-minio",level:3},{value:"Clean Up",id:"clean-up",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"deploy-using-pulumi",children:"Deploy Using Pulumi"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["At the time of writing, the Defang Pulumi Provider only works with ",(0,t.jsx)(n.a,{href:"/docs/concepts/defang-playground",children:"Defang Playground"}),". We are working on ",(0,t.jsx)(n.a,{href:"/docs/concepts/defang-byoc",children:"BYOC"})," support."]})}),"\n",(0,t.jsx)(n.p,{children:"This tutorial will show you how to deploy Minio with Pulumi using the Defang Provider."}),"\n",(0,t.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/A4uiP5FIgg0?si=BHZLOxN4noJ56f7x",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),"\n",(0,t.jsx)(n.h2,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/concepts/authentication",children:"A Defang Account"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.pulumi.com/docs/install",children:"Pulumi CLI"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/getting-started#install-the-defang-cli",children:"The Defang CLI"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/concepts/pulumi#install-the-defang-pulumi-provider",children:"The Defang Pulumi Provider"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-1---authenticate-with-defang",children:"Step 1 - Authenticate With Defang"}),"\n",(0,t.jsxs)(n.p,{children:["Make sure you are logged into the ",(0,t.jsx)(n.a,{href:"/docs/concepts/authentication",children:"Defang CLI"}),". Don't worry about the Pulumi CLI for now."]}),"\n",(0,t.jsx)(n.h2,{id:"step-2---configure-the-pulumi-backend",children:"Step 2 - Configure the Pulumi Backend"}),"\n",(0,t.jsxs)(n.p,{children:["Navigate to your project directly. (If you don't have a project yet, try one of our ",(0,t.jsx)(n.a,{href:"https://defang.io/#samples",children:"samples"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["Pulumi uses the ",(0,t.jsx)(n.code,{children:"pulumi login"})," command to select a backend. In this tutorial, we will use the Local Filesystem backend for simplicity. When you are ready to deploy to production, you will probably want to look into other ",(0,t.jsx)(n.a,{href:"https://www.pulumi.com/docs/iac/concepts/state-and-backends",children:"Pulumi backend options"}),"."]}),"\n",(0,t.jsx)(n.p,{children:'Run the following command to "login" to the filesystem backend in the local directory.'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pulumi login file://./\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will make the Pulumi CLI store the state of your infrastructure in the current directory."}),"\n",(0,t.jsx)(n.h2,{id:"step-3---initialize-the-pulumi-project",children:"Step 3 - Initialize the Pulumi Project"}),"\n",(0,t.jsx)(n.p,{children:"Run the following command to set your encryption passphrase for this terminal session:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export PULUMI_CONFIG_PASSPHRASE="super-secure-passphrase"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now let's initialize the Pulumi project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pulumi new typescript -y --force\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will create a new Pulumi project in the current directory and will create a Pulumi stack called ",(0,t.jsx)(n.code,{children:"dev"})," by default. We use the ",(0,t.jsx)(n.code,{children:"--force"})," flag because the directory isn't empty (we created a folder when we logged in with the Pulumi CLI)."]}),"\n",(0,t.jsxs)(n.p,{children:["Run the following command to add to the ",(0,t.jsx)(n.code,{children:".gitignore"})," file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo ".pulumi" >> .gitignore\n'})}),"\n",(0,t.jsx)(n.h2,{id:"step-4---write-your-pulumi-code",children:"Step 4 - Write Your Pulumi Code"}),"\n",(0,t.jsxs)(n.p,{children:["Create an ",(0,t.jsx)(n.code,{children:"index.ts"})," file to contain your Pulumi code. This code will describe our services, our service's dependencies, and our service's configuration."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import * as defang from '@defang-io/pulumi-defang/lib';\n\nexport const service = new defang.DefangService('minio', {\n    name: 'minio',\n    image: 'quay.io/minio/minio',\n    // starts the server with the console address set to :9001\n    command: ['server', '--console-address', ':9001', '/data'],\n    // Set the root username\n    environment: {\n        MINIO_ROOT_USER: 'minio',\n    },\n    secrets: [\n        // Set the root password as a secret which will be encrypted at rest\n        {\n            source: 'MINIO_ROOT_PASSWORD',\n            value: 'minio123',\n        },\n    ],\n    // Run a healthcheck every 30 seconds\n    healthcheck: {\n        test: ['CMD', 'curl', 'http://localhost:9000/minio/health/live'],\n        interval: 30,\n        timeout: 5,\n        retries: 3,\n    },\n    // Expose the server on port 9000 and the console on port 9001\n    ports: [\n        {\n            target: 9000,\n            protocol: 'http',\n            mode: 'ingress',\n        },\n        {\n            target: 9001,\n            protocol: 'http',\n            mode: 'ingress',\n        },\n    ],\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-5---deploy-to-defang",children:"Step 5 - Deploy to Defang"}),"\n",(0,t.jsx)(n.p,{children:"Now we're ready to deploy to Defang with Pulumi! Run the following command to deploy your service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pulumi up --stack=dev\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-6---monitor-the-deployment",children:"Step 6 - Monitor the Deployment"}),"\n",(0,t.jsx)(n.p,{children:"You can monitor the deployment by running the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"defang tail --name minio\n"})}),"\n",(0,t.jsx)(n.h3,{id:"logging-into-minio",children:"Logging Into Minio"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"/docs/concepts/defang-playground",children:"Defang Playground"})," will give you a domain, which you can obtain by running the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"defang ls | grep 'minio.*9001'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you navigate to the domain in your browser, you will be prompted to log in. Use the username ",(0,t.jsx)(n.code,{children:"minio"})," and the password ",(0,t.jsx)(n.code,{children:"minio123"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"clean-up",children:"Clean Up"}),"\n",(0,t.jsx)(n.p,{children:"To clean up the deployment, run the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pulumi destroy --stack=dev\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"/docs/concepts/pulumi",children:"Pulumi concept docs"})," for more information about the Defang Pulumi Provider."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>s});var t=i(6540);const o={},r=t.createContext(o);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);