"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[1078],{11470:(e,t,n)=>{n.d(t,{A:()=>v});var o=n(96540),r=n(18215),i=n(17559),s=n(23104),a=n(56347),l=n(205),c=n(57485),u=n(31682),d=n(70679);function h(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??function(e){return h(e).map((({props:{value:e,label:t,attributes:n,default:o}})=>({value:e,label:t,attributes:n,default:o})))}(n);return function(e){const t=(0,u.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function f({value:e,tabValues:t}){return t.some((t=>t.value===e))}function b({queryString:e=!1,groupId:t}){const n=(0,a.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,i=p(e),[s,a]=(0,o.useState)((()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!f({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[c,u]=b({queryString:n,groupId:r}),[h,m]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,d.Dv)(t);return[n,(0,o.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:r}),y=(()=>{const e=c??h;return f({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{y&&a(y)}),[y]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!f({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),m(e)}),[u,m,i]),tabValues:i}}var y=n(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(74848);function j({className:e,block:t,selectedValue:n,selectValue:o,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const t=e.currentTarget,r=a.indexOf(t),s=i[r].value;s!==n&&(l(t),o(s))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:i.map((({value:e,label:t,attributes:o})=>(0,x.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:u,onClick:c,...o,className:(0,r.A)("tabs__item",g.tabItem,o?.className,{"tabs__item--active":n===e}),children:t??e},e)))})}function A({lazy:e,children:t,selectedValue:n}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find((e=>e.props.value===n));return e?(0,o.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function w(e){const t=m(e);return(0,x.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",g.tabList),children:[(0,x.jsx)(j,{...t,...e}),(0,x.jsx)(A,{...t,...e})]})}function v(e){const t=(0,y.A)();return(0,x.jsx)(w,{...e,children:h(e.children)},String(t))}},19365:(e,t,n)=>{n.d(t,{A:()=>s});n(96540);var o=n(18215);const r={tabItem:"tabItem_Ymn6"};var i=n(74848);function s({children:e,hidden:t,className:n}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,o.A)(r.tabItem,n),hidden:t,children:e})}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var o=n(96540);const r={},i=o.createContext(r);function s(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:t},e.children)}},58491:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"tutorials/deploying-from-github-actions/to-aws","title":"Deploying to AWS","description":"Using the Defang Github Action to deploy your project to AWS from your CI/CD pipeline.","source":"@site/docs/tutorials/deploying-from-github-actions/to-aws.mdx","sourceDirName":"tutorials/deploying-from-github-actions","slug":"/tutorials/deploying-from-github-actions/to-aws","permalink":"/docs/tutorials/deploying-from-github-actions/to-aws","draft":false,"unlisted":false,"editUrl":"https://github.com/DefangLabs/defang-docs/tree/main/docs/tutorials/deploying-from-github-actions/to-aws.mdx","tags":[],"version":"current","frontMatter":{"title":"Deploying to AWS","description":"Using the Defang Github Action to deploy your project to AWS from your CI/CD pipeline."},"sidebar":"tutorialsSidebar","previous":{"title":"Deploying From Github Actions","permalink":"/docs/category/deploying-from-github-actions"},"next":{"title":"Deploying to GCP","permalink":"/docs/tutorials/deploying-from-github-actions/to-gcp"}}');var r=n(74848),i=n(28453),s=n(11470),a=n(19365);const l={title:"Deploying to AWS",description:"Using the Defang Github Action to deploy your project to AWS from your CI/CD pipeline."},c="Deploying to AWS from GitHub Actions",u={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1 - Identify your AWS Account ID",id:"step-1---identify-your-aws-account-id",level:2},{value:"Step 2 - Create an AWS Identity Provider for GitHub Actions",id:"step-2---create-an-aws-identity-provider-for-github-actions",level:2},{value:"Step 3 - Create a deployer role with trust relationship for GitHub Actions",id:"step-3---create-a-deployer-role-with-trust-relationship-for-github-actions",level:2},{value:"Step 4 - Create a new GitHub Actions workflow",id:"step-4---create-a-new-github-actions-workflow",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"deploying-to-aws-from-github-actions",children:"Deploying to AWS from GitHub Actions"})}),"\n",(0,r.jsxs)(t.p,{children:["This tutorial will show you how to use the ",(0,r.jsx)(t.a,{href:"https://github.com/DefangLabs/defang-github-action",children:"Defang GitHub Action"})," to deploy your project to AWS from your GitHub Actions workflow."]}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/docs/concepts/authentication",children:"A Defang Account"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.github.com/en/get-started/quickstart/create-a-repo",children:"A Github Repo"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://aws.amazon.com",children:"An AWS Account"})}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The following steps will guide you through setting up a GitHub Actions workflow that can assume a role in your AWS account using OpenID Connect (OIDC) and deploy your project using the Defang GitHub Action. The role which will be assumed must have a trust relationship with an OIDC identity provider (IdP) for GitHub Actions, and that trust relationship must be configured to allow the specific repository and branch to assume the role. This ultimately allows the GitHub Actions workflow to securely access your AWS resources without needing to store long-lived AWS credentials in your repository."}),"\n",(0,r.jsx)(t.h2,{id:"step-1---identify-your-aws-account-id",children:"Step 1 - Identify your AWS Account ID"}),"\n",(0,r.jsx)(t.p,{children:"To configure the GitHub Action to assume a role in your AWS account, you'll need your AWS Account ID."}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsx)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"aws sts get-caller-identity --query Account --output text\n123456789012 # for example\n"})})}),(0,r.jsx)(a.A,{value:"dashboard",label:"AWS Dashboard",children:(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Go to the ",(0,r.jsx)(t.a,{href:"https://aws.amazon.com/console/",children:"AWS Management Console"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"In the top right corner, click on your account name or number."}),"\n",(0,r.jsx)(t.li,{children:"Your AWS Account ID will be displayed in the dropdown menu."}),"\n"]})})]}),"\n",(0,r.jsx)(t.h2,{id:"step-2---create-an-aws-identity-provider-for-github-actions",children:"Step 2 - Create an AWS Identity Provider for GitHub Actions"}),"\n",(0,r.jsx)(t.p,{children:"You will need to create a new OIDC Identity Provider in AWS to enable GitHub Actions to assume roles in your AWS account."}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsxs)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:[(0,r.jsx)(t.p,{children:"Using the AWS CLI:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"aws iam create-open-id-connect-provider --client-id-list sts.amazonaws.com --url https://token.actions.githubusercontent.com\n"})})]}),(0,r.jsxs)(a.A,{value:"dashboard",label:"AWS Dashboard",children:[(0,r.jsx)(t.p,{children:"Using the AWS Dashboard:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Go to the ",(0,r.jsx)(t.a,{href:"https://console.aws.amazon.com/iam/home#/roles",children:"AWS IAM Console"}),"."]}),"\n",(0,r.jsx)(t.li,{children:'Click on "Identity providers" in the left sidebar.'}),"\n",(0,r.jsx)(t.li,{children:'Click on "Add provider".'}),"\n",(0,r.jsx)(t.li,{children:'Choose "OIDC" as the provider type.'}),"\n",(0,r.jsxs)(t.li,{children:["For the provider URL, enter ",(0,r.jsx)(t.code,{children:"https://token.actions.githubusercontent.com"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["For the audience, enter ",(0,r.jsx)(t.code,{children:"sts.amazonaws.com"}),"."]}),"\n",(0,r.jsx)(t.li,{children:'Click "Add provider".'}),"\n"]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"step-3---create-a-deployer-role-with-trust-relationship-for-github-actions",children:"Step 3 - Create a deployer role with trust relationship for GitHub Actions"}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsxs)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:[(0,r.jsx)(t.p,{children:"Using the AWS CLI:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Create a trust policy document"}),"\n"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'cat > deployer-policy.json << EOF\n{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": "*",\n      "Resource": "*"\n    },\n    {\n      "Sid": "OidcForGitHub",\n      "Effect": "Allow",\n      "Principal": {\n        "Federated": "arn:aws:iam::YOUR_AWS_ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com"\n      },\n      "Action": "sts:AssumeRoleWithWebIdentity",\n      "Condition": {\n        "StringLike": {\n          "token.actions.githubusercontent.com:sub": "repo:YOUR_REPO_OWNER/YOUR_REPO_NAME:ref:refs/heads/YOUR_BRANCH_NAME"\n        },\n        "StringEquals": {\n          "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"\n        }\n      }\n    }\n  ]\n}\nEOF\n'})}),(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsxs)(t.li,{children:["Edit the ",(0,r.jsx)(t.code,{children:"deployer-policy.json"})," file to replace the following placeholders:"]}),"\n"]}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"YOUR_AWS_ACCOUNT_ID"})," replace this with your actual AWS Account ID"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"YOUR_REPO_OWNER"})," your GitHub username or organization name (e.g., ",(0,r.jsx)(t.code,{children:"ACMELabs"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"YOUR_REPO_NAME"})," your GitHub repository name (e.g., ",(0,r.jsx)(t.code,{children:"my-project"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"YOUR_BRANCH_NAME"})," the branch you want to deploy from (e.g., ",(0,r.jsx)(t.code,{children:"main"}),"). If you want to allow multiple branches, you can use a wildcard like ",(0,r.jsx)(t.code,{children:"*"})]}),"\n"]}),(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsx)(t.li,{children:"Create a deployer role"}),"\n"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"aws iam create-role --role-name deployer --assume-role-policy-document file://deployer-policy.json\n"})})]}),(0,r.jsxs)(a.A,{value:"dashboard",label:"AWS Dashboard",children:[(0,r.jsx)(t.p,{children:"Using the AWS Dashboard:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Navigate to ",(0,r.jsx)(t.a,{href:"https://console.aws.amazon.com/iam/home#/roles",children:"AWS IAM Console"}),"."]}),"\n",(0,r.jsx)(t.li,{children:'Click on "Create role".'}),"\n",(0,r.jsx)(t.li,{children:'Select "Web identity" as the trusted entity type.'}),"\n",(0,r.jsx)(t.li,{children:"For the identity provider, select the OIDC provider you created in the previous step."}),"\n",(0,r.jsxs)(t.li,{children:["For the audience, enter ",(0,r.jsx)(t.code,{children:"sts.amazonaws.com"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["For the GitHub organization, enter your GitHub username or organization name (e.g., ",(0,r.jsx)(t.code,{children:"ACMELabs"}),")."]}),"\n",(0,r.jsxs)(t.li,{children:["For the GitHub repository, enter your GitHub repository name (e.g., ",(0,r.jsx)(t.code,{children:"my-project"}),")."]}),"\n",(0,r.jsxs)(t.li,{children:["For the GitHub branch, enter the branch you want to deploy from (e.g., ",(0,r.jsx)(t.code,{children:"main"}),"). If you want to allow multiple branches, you can use a wildcard like ",(0,r.jsx)(t.code,{children:"*"}),"."]}),"\n",(0,r.jsx)(t.li,{children:'Click "Next".'}),"\n",(0,r.jsxs)(t.li,{children:["Select the ",(0,r.jsx)(t.code,{children:"AdministratorAccess"})," policy to attach to the role."]}),"\n",(0,r.jsx)(t.li,{children:'Click "Next".'}),"\n",(0,r.jsxs)(t.li,{children:["For the role name, enter ",(0,r.jsx)(t.code,{children:"deployer"}),"."]}),"\n",(0,r.jsx)(t.li,{children:'For the role description, enter "This role is assumed by GitHub Actions when deploying with Defang".'}),"\n",(0,r.jsx)(t.li,{children:'Click "Create role".'}),"\n"]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"step-4---create-a-new-github-actions-workflow",children:"Step 4 - Create a new GitHub Actions workflow"}),"\n",(0,r.jsxs)(t.p,{children:["In your GitHub repository, create a new file at ",(0,r.jsx)(t.code,{children:".github/workflows/deploy.yml"})," with the following content:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"name: Deploy with Defang\non:\n  push:\n    branches:\n      - main  # Change this to your default branch if it's not 'main', this must match the branch you specified in the deployer role's trust relationship.\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      id-token: write\n\n    steps:\n      - name: Configure AWS Credentials for CI\n        uses: aws-actions/configure-aws-credentials@v4\n        with:\n          aws-region: us-west-2\n          # Replace with your AWS Account ID and the name of the role which we previously created.\n          role-to-assume: arn:aws:iam::123456789012:role/deployer\n\n      - name: Checkout Repo\n        uses: actions/checkout@v4\n\n      - name: Deploy\n        uses: DefangLabs/defang-github-action@v1.2.1\n        with:\n          provider: \"aws\"\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["Full documentation for configuring AWS can be found in the ",(0,r.jsx)(t.a,{href:"https://github.com/DefangLabs/defang-github-action",children:"Defang GitHub Action repository"}),"."]})}),"\n",(0,r.jsxs)(t.p,{children:["Now you have configured a GitHub Actions workflow that uses the Defang GitHub Action to deploy your project to AWS securely using OIDC and short-lived credentials. Whenever you push to the specified branch, the workflow will run and deploy your project using the permissions granted to the ",(0,r.jsx)(t.code,{children:"deployer"})," role in your AWS account."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);