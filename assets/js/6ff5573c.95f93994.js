"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[1078],{11470:(e,n,t)=>{t.d(n,{A:()=>v});var o=t(96540),i=t(18215),r=t(17559),s=t(23104),a=t(56347),l=t(205),c=t(57485),d=t(31682),u=t(70679);function h(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:t,default:o}})=>({value:e,label:n,attributes:t,default:o})))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function f({value:e,tabValues:n}){return n.some((n=>n.value===e))}function g({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(i),(0,o.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,r=p(e),[s,a]=(0,o.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!f({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r}))),[c,d]=g({queryString:t,groupId:i}),[h,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,u.Dv)(n);return[t,(0,o.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),y=(()=>{const e=c??h;return f({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{y&&a(y)}),[y]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!f({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);a(e),d(e),m(e)}),[d,m,r]),tabValues:r}}var y=t(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(74848);function b({className:e,block:n,selectedValue:t,selectValue:o,tabValues:r}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const n=e.currentTarget,i=a.indexOf(n),s=r[i].value;s!==t&&(l(n),o(s))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:r.map((({value:e,label:n,attributes:o})=>(0,j.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...o,className:(0,i.A)("tabs__item",x.tabItem,o?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function A({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===t));return e?(0,o.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function w(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,i.A)(r.G.tabs.container,"tabs-container",x.tabList),children:[(0,j.jsx)(b,{...n,...e}),(0,j.jsx)(A,{...n,...e})]})}function v(e){const n=(0,y.A)();return(0,j.jsx)(w,{...e,children:h(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var o=t(18215);const i={tabItem:"tabItem_Ymn6"};var r=t(74848);function s({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)(i.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var o=t(96540);const i={},r=o.createContext(i);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}},58491:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>u});const o=JSON.parse('{"id":"tutorials/deploying-from-github-actions/to-aws","title":"Deploying to AWS","description":"Using the Defang GitHub Action to deploy your project to AWS from your CI/CD pipeline.","source":"@site/docs/tutorials/deploying-from-github-actions/to-aws.mdx","sourceDirName":"tutorials/deploying-from-github-actions","slug":"/tutorials/deploying-from-github-actions/to-aws","permalink":"/docs/tutorials/deploying-from-github-actions/to-aws","draft":false,"unlisted":false,"editUrl":"https://github.com/DefangLabs/defang-docs/tree/main/docs/tutorials/deploying-from-github-actions/to-aws.mdx","tags":[],"version":"current","frontMatter":{"title":"Deploying to AWS","description":"Using the Defang GitHub Action to deploy your project to AWS from your CI/CD pipeline."},"sidebar":"tutorialsSidebar","previous":{"title":"Deploying From Github Actions","permalink":"/docs/category/deploying-from-github-actions"},"next":{"title":"Deploying to GCP","permalink":"/docs/tutorials/deploying-from-github-actions/to-gcp"}}');var i=t(74848),r=t(28453),s=t(11470),a=t(19365);const l={title:"Deploying to AWS",description:"Using the Defang GitHub Action to deploy your project to AWS from your CI/CD pipeline."},c="Deploying to AWS from GitHub Actions",d={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Overview",id:"overview",level:2},{value:"Option 1: Using the Defang Portal (Recommended)",id:"option-1-using-the-defang-portal-recommended",level:2},{value:"Step 1 - Configure AWS via the Portal",id:"step-1---configure-aws-via-the-portal",level:3},{value:"Step 2 - Create your GitHub Actions workflow",id:"step-2---create-your-github-actions-workflow",level:3},{value:"Step 3 - Configure secrets (if needed)",id:"step-3---configure-secrets-if-needed",level:3},{value:"Important: Stack Configuration Files",id:"important-stack-configuration-files",level:3},{value:"Option 2: Manual AWS Configuration",id:"option-2-manual-aws-configuration",level:2},{value:"Step 1 - Identify your AWS Account ID",id:"step-1---identify-your-aws-account-id",level:3},{value:"Step 2 - Create an AWS Identity Provider for GitHub Actions",id:"step-2---create-an-aws-identity-provider-for-github-actions",level:3},{value:"Step 3 - Create a deployer role with trust relationship for GitHub Actions",id:"step-3---create-a-deployer-role-with-trust-relationship-for-github-actions",level:3},{value:"Step 4 - Create a new GitHub Actions workflow",id:"step-4---create-a-new-github-actions-workflow",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"deploying-to-aws-from-github-actions",children:"Deploying to AWS from GitHub Actions"})}),"\n",(0,i.jsxs)(n.p,{children:["This tutorial will show you how to use the ",(0,i.jsx)(n.a,{href:"https://github.com/DefangLabs/defang-github-action",children:"Defang GitHub Action"})," to deploy your project to AWS from your GitHub Actions workflow."]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/concepts/authentication",children:"A Defang Account"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.github.com/en/get-started/quickstart/create-a-repo",children:"A GitHub Repo"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://aws.amazon.com",children:"An AWS Account"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Defang GitHub Action uses OpenID Connect (OIDC) to securely authenticate with your AWS account without storing long-lived credentials. This requires:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"An OIDC identity provider in your AWS account that trusts GitHub Actions"}),"\n",(0,i.jsx)(n.li,{children:"An IAM role that GitHub Actions can assume"}),"\n",(0,i.jsx)(n.li,{children:"A GitHub Actions workflow configured with the correct permissions"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The easiest way to set this up is using the ",(0,i.jsx)(n.strong,{children:"Defang Portal"}),", which automates the AWS configuration with a single CloudFormation stack. Alternatively, you can ",(0,i.jsx)(n.a,{href:"#option-2-manual-aws-configuration",children:"configure AWS manually"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"option-1-using-the-defang-portal-recommended",children:"Option 1: Using the Defang Portal (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"The Defang Portal provides a streamlined setup experience that creates all required AWS resources automatically."}),"\n",(0,i.jsx)(n.h3,{id:"step-1---configure-aws-via-the-portal",children:"Step 1 - Configure AWS via the Portal"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.a,{href:"https://portal.defang.io",children:"portal.defang.io"})," and log in"]}),"\n",(0,i.jsxs)(n.li,{children:["Navigate to ",(0,i.jsx)(n.strong,{children:"Clouds"})," \u2192 ",(0,i.jsx)(n.strong,{children:"AWS"})]}),"\n",(0,i.jsx)(n.li,{children:"Select your GitHub organization"}),"\n",(0,i.jsxs)(n.li,{children:["Choose whether to allow ",(0,i.jsx)(n.strong,{children:"all repos"})," or ",(0,i.jsx)(n.strong,{children:"private repos only"})]}),"\n",(0,i.jsx)(n.li,{children:"Enter your AWS Account ID and select your preferred region"}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Launch CloudFormation"})," to open AWS CloudFormation with pre-filled parameters"]}),"\n",(0,i.jsxs)(n.li,{children:["In AWS CloudFormation, review the stack and click ",(0,i.jsx)(n.strong,{children:"Create stack"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This creates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"An OIDC identity provider for GitHub Actions"}),"\n",(0,i.jsxs)(n.li,{children:["An IAM role named ",(0,i.jsx)(n.code,{children:"defang-cd-CIRole"})," with the necessary trust policy"]}),"\n",(0,i.jsx)(n.li,{children:"Other resources needed for Defang deployments"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-2---create-your-github-actions-workflow",children:"Step 2 - Create your GitHub Actions workflow"}),"\n",(0,i.jsxs)(n.p,{children:["In your GitHub repository, create a new file at ",(0,i.jsx)(n.code,{children:".github/workflows/deploy.yml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: Deploy with Defang\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      id-token: write  # Required for OIDC authentication\n\n    steps:\n      - name: Checkout Repo\n        uses: actions/checkout@v4\n\n      - name: Deploy\n        uses: DefangLabs/defang-github-action@v1.4.0\n        with:\n          provider: aws\n          # stack: production # optional, but recommended to use stacks https://docs.defang.io/docs/concepts/stacks\n        env:\n          AWS_REGION: us-west-2  # Change to your preferred region\n          AWS_ROLE_ARN: arn:aws:iam::YOUR_AWS_ACCOUNT_ID:role/defang-cd-CIRole\n"})}),"\n",(0,i.jsx)(n.p,{children:"Replace:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YOUR_AWS_ACCOUNT_ID"})," with your 12-digit AWS account ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"us-west-2"})," with your preferred AWS region (must match the region you selected in the Portal)"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["The Defang CLI handles OIDC authentication internally when ",(0,i.jsx)(n.code,{children:"AWS_ROLE_ARN"})," is set. You don't need the ",(0,i.jsx)(n.code,{children:"aws-actions/configure-aws-credentials"})," action."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-3---configure-secrets-if-needed",children:"Step 3 - Configure secrets (if needed)"}),"\n",(0,i.jsx)(n.p,{children:"If your application requires secrets or configuration values, add them to your workflow:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: Deploy\n  uses: DefangLabs/defang-github-action@v1.4.0\n  with:\n    provider: aws\n    config-env-vars: |\n      DATABASE_URL\n      API_KEY\n  env:\n    AWS_REGION: us-west-2\n    AWS_ROLE_ARN: arn:aws:iam::YOUR_AWS_ACCOUNT_ID:role/defang-cd-CIRole\n    DATABASE_URL: ${{ secrets.DATABASE_URL }}\n    API_KEY: ${{ secrets.API_KEY }}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"important-stack-configuration-files",children:"Important: Stack Configuration Files"}),"\n",(0,i.jsxs)(n.p,{children:["If you have a ",(0,i.jsx)(n.code,{children:".defang/"})," directory with stack configuration files (e.g., ",(0,i.jsx)(n.code,{children:".defang/production"}),"), make sure they don't include ",(0,i.jsx)(n.code,{children:"AWS_PROFILE"}),". The profile setting is for local development only and will cause errors in CI/CD:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# .defang/production - CI/CD compatible\nAWS_REGION="us-west-2"\nDEFANG_PROVIDER="aws"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# .defang/production - NOT CI/CD compatible (will fail)\nAWS_PROFILE="my-local-profile"  # Remove this line\nAWS_REGION="us-west-2"\nDEFANG_PROVIDER="aws"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"option-2-manual-aws-configuration",children:"Option 2: Manual AWS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"If you prefer to configure AWS manually or need more control over the setup, follow the steps below."}),"\n",(0,i.jsx)(n.p,{children:"The following steps will guide you through setting up a GitHub Actions workflow that can assume a role in your AWS account using OpenID Connect (OIDC) and deploy your project using the Defang GitHub Action. The role which will be assumed must have a trust relationship with an OIDC identity provider (IdP) for GitHub Actions, and that trust relationship must be configured to allow the specific repository and branch to assume the role. This ultimately allows the GitHub Actions workflow to securely access your AWS resources without needing to store long-lived AWS credentials in your repository."}),"\n",(0,i.jsx)(n.h3,{id:"step-1---identify-your-aws-account-id",children:"Step 1 - Identify your AWS Account ID"}),"\n",(0,i.jsx)(n.p,{children:"To configure the GitHub Action to assume a role in your AWS account, you'll need your AWS Account ID."}),"\n",(0,i.jsxs)(s.A,{children:[(0,i.jsx)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws sts get-caller-identity --query Account --output text\n123456789012 # for example\n"})})}),(0,i.jsx)(a.A,{value:"dashboard",label:"AWS Dashboard",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to the ",(0,i.jsx)(n.a,{href:"https://aws.amazon.com/console/",children:"AWS Management Console"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"In the top right corner, click on your account name or number."}),"\n",(0,i.jsx)(n.li,{children:"Your AWS Account ID will be displayed in the dropdown menu."}),"\n"]})})]}),"\n",(0,i.jsx)(n.h3,{id:"step-2---create-an-aws-identity-provider-for-github-actions",children:"Step 2 - Create an AWS Identity Provider for GitHub Actions"}),"\n",(0,i.jsx)(n.p,{children:"You will need to create a new OIDC Identity Provider in AWS to enable GitHub Actions to assume roles in your AWS account."}),"\n",(0,i.jsxs)(s.A,{children:[(0,i.jsxs)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:[(0,i.jsx)(n.p,{children:"Using the AWS CLI:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"aws iam create-open-id-connect-provider --client-id-list sts.amazonaws.com --url https://token.actions.githubusercontent.com\n"})})]}),(0,i.jsxs)(a.A,{value:"dashboard",label:"AWS Dashboard",children:[(0,i.jsx)(n.p,{children:"Using the AWS Dashboard:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to the ",(0,i.jsx)(n.a,{href:"https://console.aws.amazon.com/iam/home#/roles",children:"AWS IAM Console"}),"."]}),"\n",(0,i.jsx)(n.li,{children:'Click on "Identity providers" in the left sidebar.'}),"\n",(0,i.jsx)(n.li,{children:'Click on "Add provider".'}),"\n",(0,i.jsx)(n.li,{children:'Choose "OIDC" as the provider type.'}),"\n",(0,i.jsxs)(n.li,{children:["For the provider URL, enter ",(0,i.jsx)(n.code,{children:"https://token.actions.githubusercontent.com"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For the audience, enter ",(0,i.jsx)(n.code,{children:"sts.amazonaws.com"}),"."]}),"\n",(0,i.jsx)(n.li,{children:'Click "Add provider".'}),"\n"]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"step-3---create-a-deployer-role-with-trust-relationship-for-github-actions",children:"Step 3 - Create a deployer role with trust relationship for GitHub Actions"}),"\n",(0,i.jsxs)(s.A,{children:[(0,i.jsxs)(a.A,{value:"cli",label:"AWS CLI",default:!0,children:[(0,i.jsx)(n.p,{children:"Using the AWS CLI:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a trust policy document"}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'cat > deployer-policy.json << EOF\n{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": "*",\n      "Resource": "*"\n    },\n    {\n      "Sid": "OidcForGitHub",\n      "Effect": "Allow",\n      "Principal": {\n        "Federated": "arn:aws:iam::YOUR_AWS_ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com"\n      },\n      "Action": "sts:AssumeRoleWithWebIdentity",\n      "Condition": {\n        "StringLike": {\n          "token.actions.githubusercontent.com:sub": "repo:YOUR_REPO_OWNER/YOUR_REPO_NAME:ref:refs/heads/YOUR_BRANCH_NAME"\n        },\n        "StringEquals": {\n          "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"\n        }\n      }\n    }\n  ]\n}\nEOF\n'})}),(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Edit the ",(0,i.jsx)(n.code,{children:"deployer-policy.json"})," file to replace the following placeholders:"]}),"\n"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YOUR_AWS_ACCOUNT_ID"})," replace this with your actual AWS Account ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YOUR_REPO_OWNER"})," your GitHub username or organization name (e.g., ",(0,i.jsx)(n.code,{children:"ACMELabs"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YOUR_REPO_NAME"})," your GitHub repository name (e.g., ",(0,i.jsx)(n.code,{children:"my-project"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YOUR_BRANCH_NAME"})," the branch you want to deploy from (e.g., ",(0,i.jsx)(n.code,{children:"main"}),"). If you want to allow multiple branches, you can use a wildcard like ",(0,i.jsx)(n.code,{children:"*"})]}),"\n"]}),(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Create a deployer role"}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"aws iam create-role --role-name deployer --assume-role-policy-document file://deployer-policy.json\n"})})]}),(0,i.jsxs)(a.A,{value:"dashboard",label:"AWS Dashboard",children:[(0,i.jsx)(n.p,{children:"Using the AWS Dashboard:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to ",(0,i.jsx)(n.a,{href:"https://console.aws.amazon.com/iam/home#/roles",children:"AWS IAM Console"}),"."]}),"\n",(0,i.jsx)(n.li,{children:'Click on "Create role".'}),"\n",(0,i.jsx)(n.li,{children:'Select "Web identity" as the trusted entity type.'}),"\n",(0,i.jsx)(n.li,{children:"For the identity provider, select the OIDC provider you created in the previous step."}),"\n",(0,i.jsxs)(n.li,{children:["For the audience, enter ",(0,i.jsx)(n.code,{children:"sts.amazonaws.com"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For the GitHub organization, enter your GitHub username or organization name (e.g., ",(0,i.jsx)(n.code,{children:"ACMELabs"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["For the GitHub repository, enter your GitHub repository name (e.g., ",(0,i.jsx)(n.code,{children:"my-project"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["For the GitHub branch, enter the branch you want to deploy from (e.g., ",(0,i.jsx)(n.code,{children:"main"}),"). If you want to allow multiple branches, you can use a wildcard like ",(0,i.jsx)(n.code,{children:"*"}),"."]}),"\n",(0,i.jsx)(n.li,{children:'Click "Next".'}),"\n",(0,i.jsxs)(n.li,{children:["Select the ",(0,i.jsx)(n.code,{children:"AdministratorAccess"})," policy to attach to the role."]}),"\n",(0,i.jsx)(n.li,{children:'Click "Next".'}),"\n",(0,i.jsxs)(n.li,{children:["For the role name, enter ",(0,i.jsx)(n.code,{children:"deployer"}),"."]}),"\n",(0,i.jsx)(n.li,{children:'For the role description, enter "This role is assumed by GitHub Actions when deploying with Defang".'}),"\n",(0,i.jsx)(n.li,{children:'Click "Create role".'}),"\n"]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"step-4---create-a-new-github-actions-workflow",children:"Step 4 - Create a new GitHub Actions workflow"}),"\n",(0,i.jsxs)(n.p,{children:["In your GitHub repository, create a new file at ",(0,i.jsx)(n.code,{children:".github/workflows/deploy.yml"})," with the following content:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'name: Deploy with Defang\non:\n  push:\n    branches:\n      - main  # Change this to your default branch if it\'s not \'main\', this must match the branch you specified in the deployer role\'s trust relationship.\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      id-token: write\n\n    steps:\n      - name: Configure AWS Credentials for CI\n        uses: aws-actions/configure-aws-credentials@v4\n        with:\n          aws-region: us-west-2\n          # Replace with your AWS Account ID and the name of the role which we previously created.\n          role-to-assume: arn:aws:iam::123456789012:role/deployer\n\n      - name: Checkout Repo\n        uses: actions/checkout@v4\n\n      - name: Deploy\n        uses: DefangLabs/defang-github-action@v1.4.0\n        with:\n          provider: "aws"\n          stack: "mystack"\n          mode: "affordable"\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Full documentation for configuring AWS can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/DefangLabs/defang-github-action",children:"Defang GitHub Action repository"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["Now you have configured a GitHub Actions workflow that uses the Defang GitHub Action to deploy your project to AWS securely using OIDC and short-lived credentials. Whenever you push to the specified branch, the workflow will run and deploy your project using the permissions granted to the ",(0,i.jsx)(n.code,{children:"deployer"})," role in your AWS account."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);