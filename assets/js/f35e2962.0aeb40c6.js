"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[4007],{12979:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"concepts/configuration","title":"Configuration","description":"Configuring your Defang application, including sensitive config values like API keys, passwords, and other credentials.","source":"@site/docs/concepts/configuration.md","sourceDirName":"concepts","slug":"/concepts/configuration","permalink":"/docs/concepts/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/DefangLabs/defang-docs/tree/main/docs/concepts/configuration.md","tags":[],"version":"current","frontMatter":{"title":"Configuration","description":"Configuring your Defang application, including sensitive config values like API keys, passwords, and other credentials."},"sidebar":"conceptsSidebar","previous":{"title":"Compose","permalink":"/docs/concepts/compose"},"next":{"title":"Debug","permalink":"/docs/concepts/debug"}}');var o=i(74848),r=i(28453);const t={title:"Configuration",description:"Configuring your Defang application, including sensitive config values like API keys, passwords, and other credentials."},a="Configuration",c={},l=[{value:"With List Notation",id:"with-list-notation",level:4},{value:"With Map Notation",id:"with-map-notation",level:4},{value:"Interpolation",id:"interpolation",level:2},{value:"Environment Variable Precedence",id:"environment-variable-precedence",level:2},{value:"Using Config with Pulumi",id:"using-config-with-pulumi",level:2},{value:"Connecting Services",id:"connecting-services",level:2},{value:"Providers",id:"providers",level:2},{value:"Supported Providers",id:"supported-providers",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,o.jsxs)(n.p,{children:["Defang allows you to configure your application using environment variables. You can set environment variables in your ",(0,o.jsxs)(n.a,{href:"/docs/concepts/compose",children:[(0,o.jsx)(n.code,{children:"compose.yaml"})," file"]}),", or in your ",(0,o.jsx)(n.a,{href:"#using-config-with-pulumi",children:"Pulumi program"}),"."]}),"\n",(0,o.jsx)(n.h1,{id:"sensitive-config-values",children:"Sensitive Config Values"}),"\n",(0,o.jsx)(n.p,{children:"The Defang CLI allows you to securely store sensitive information such as API keys, passwords, and other credentials. To do so, run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Set a configuration value called API_KEY\ndefang config set API_KEY\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You can use sensitive config by specifying them in the ",(0,o.jsx)(n.code,{children:"environment"})," section of a service in a ",(0,o.jsx)(n.code,{children:"compose.yaml"})," file without any value, or by specifying an environment key with a ",(0,o.jsx)(n.code,{children:"null"})," value in your Pulumi code."]}),"\n",(0,o.jsx)(n.p,{children:"Either one of list notation or map notation is acceptable for defining your environment variable(s). See below for an example of each."}),"\n",(0,o.jsx)(n.h4,{id:"with-list-notation",children:"With List Notation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  service1:\n    image: image1:latest\n    environment:\n      - API_KEY\n"})}),"\n",(0,o.jsx)(n.h4,{id:"with-map-notation",children:"With Map Notation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  service1:\n    image: image1:latest\n    environment:\n      API_KEY:\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Use the ",(0,o.jsx)(n.code,{children:"defang config"})," command of the Defang CLI to manage the values."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can find a sample of how to set sensitive config values ",(0,o.jsx)(n.a,{href:"https://github.com/DefangLabs/samples/tree/main/samples/nodejs-openai",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["If you are using the ",(0,o.jsx)(n.a,{href:"/docs/tutorials/using-one-click-deploy",children:"1-Click Deploy"})," option, you can set sensitive config values as secrets in your GitHub repository and the action will automatically deploy them for you. ",(0,o.jsx)(n.a,{href:"https://github.com/DefangLabs/defang-github-action?tab=readme-ov-file#managing-config-values",children:"Learn how to manage config values with the Defang Github Action"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"interpolation",children:"Interpolation"}),"\n",(0,o.jsxs)(n.p,{children:["Environment variables are set within the ",(0,o.jsx)(n.code,{children:"environment"})," section of a service in a ",(0,o.jsx)(n.code,{children:"compose.yaml"})," file. Any variables declared here will become available within the service container."]}),"\n",(0,o.jsxs)(n.p,{children:["Variables can be set by assigning a literal value, a reference to a configuration value, or a mix of literal and variable references. Variable references are declared using either ",(0,o.jsx)(n.strong,{children:"${variable_name}"})," or ",(0,o.jsx)(n.strong,{children:"$variable_name"})," forms. It is recommended to use the bracketed form. By interpolating over variable references within a string we can construct complex strings. Interpolation may be particularly useful when constructing connection strings to other services."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"service:\n    environment:\n        - USER_PASSWORD // configuration variable\n        - USER_NAME     // configuration variable\n        - CONNECT=dbservice:${USER_NAME}:${USER_PASSWORD}@example.com:9876\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In the example above, if we assume the value of the configuration variable ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"USER_PASSWORD"})})," is ",(0,o.jsx)(n.em,{children:"password"})," then the value assigned to ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"CONNECT"})})," will resolve to ",(0,o.jsxs)(n.em,{children:["dbservice:alice",":password","@example.com:9876"]})]}),"\n",(0,o.jsxs)(n.p,{children:["During ",(0,o.jsx)(n.code,{children:"defang compose up"})," all variable references will be replaced with the actual value and made available in the container. If any referenced variable is not found the ",(0,o.jsx)(n.code,{children:"defang compose up"})," command will be canceled."]}),"\n",(0,o.jsx)(n.h2,{id:"environment-variable-precedence",children:"Environment Variable Precedence"}),"\n",(0,o.jsx)(n.p,{children:"During a deployment, config vars are exposed to your services as environment variables. Environment variables can be set in multiple places, but Defang uses the following precedence order to determine which value to use:"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Defang does pass environment variables from the shell into your services. Environment variables must be set in one of the other supported ways listed below."})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dotenv files"}),": The ",(0,o.jsx)(n.code,{children:".env"})," file in the current directory is read by default. This can be overriden per services by specifying the ",(0,o.jsx)(n.code,{children:"env_file"})," service property the ",(0,o.jsx)(n.code,{children:"compose.yaml"})," file."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Docker Compose environment variables"}),": These are environment variables defined in the ",(0,o.jsx)(n.code,{children:"environment"})," section of the service in the ",(0,o.jsx)(n.code,{children:"compose.yaml"})," file."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Defang config"}),": These are sensitive configuration values set using the ",(0,o.jsx)(n.code,{children:"defang config set FOO=bar"})," command."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Environment variables are resolved in order of precedence, with the highest precedence value taking priority. For example, if you have a variable ",(0,o.jsx)(n.code,{children:"DATABASE_URL"})," set in both a dotenv file and in Defang config, the value from Defang config will be used."]}),"\n",(0,o.jsx)(n.h2,{id:"using-config-with-pulumi",children:"Using Config with Pulumi"}),"\n",(0,o.jsxs)(n.p,{children:["In Defang, using config with ",(0,o.jsx)(n.a,{href:"/docs/concepts/pulumi",children:"Pulumi"})," gives you the advantage of being able to manage your environment variables across different environments using Pulumi stacks."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can find a sample of how to set environment variables with Pulumi ",(0,o.jsx)(n.a,{href:"https://github.com/DefangLabs/samples/tree/main/samples/pulumi-remix-postgres",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"connecting-services",children:"Connecting Services"}),"\n",(0,o.jsxs)(n.p,{children:["If you have created a service before a secret you can connect it by running the ",(0,o.jsx)(n.code,{children:"defang compose start"})," command if using the ",(0,o.jsxs)(n.a,{href:"/docs/concepts/compose",children:[(0,o.jsx)(n.code,{children:"defang compose"})," workflow"]}),". If you are using the ",(0,o.jsx)(n.a,{href:"/docs/concepts/pulumi",children:"Pulumi-based workflow"})," you will need to redeploy using Pulumi."]}),"\n",(0,o.jsx)(n.h2,{id:"providers",children:"Providers"}),"\n",(0,o.jsx)(n.p,{children:"Here are the different ways sensitive config values are stored depending on the provider you are using:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/providers/aws#secrets",children:"AWS"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/providers/digitalocean#secrets",children:"DigitalOcean"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/providers/gcp#secrets",children:"GCP"})}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Please note that while Defang supports setting sensitive config, it does not support the ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/reference/compose-file/secrets/",children:(0,o.jsx)(n.code,{children:"secrets"})})," top-level element as seen in the Compose specification. Please see our ",(0,o.jsx)(n.a,{href:"/docs/concepts/compose",children:"Compose"})," page for more details."]})}),"\n",(0,o.jsx)(n.h2,{id:"supported-providers",children:"Supported Providers"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Provider"}),(0,o.jsx)(n.th,{style:{textAlign:"center"},children:"Config Support"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Playground"}),(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"AWS"}),(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"DigitalOcean"}),(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"GCP"}),(0,o.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var s=i(96540);const o={},r=s.createContext(o);function t(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);