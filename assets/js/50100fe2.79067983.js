"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[1796],{11470:(e,n,t)=>{t.d(n,{A:()=>k});var r=t(96540),i=t(18215),a=t(17559),o=t(23104),l=t(56347),s=t(205),u=t(57485),c=t(31682),d=t(70679);function p(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return p(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function f({queryString:e=!1,groupId:n}){const t=(0,l.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,u.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,a=h(e),[o,l]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[u,c]=f({queryString:t,groupId:i}),[p,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,d.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),v=(()=>{const e=u??p;return m({value:e,tabValues:a})?e:null})();(0,s.A)((()=>{v&&l(v)}),[v]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),g(e)}),[c,g,a]),tabValues:a}}var v=t(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function y({className:e,block:n,selectedValue:t,selectValue:r,tabValues:a}){const l=[],{blockElementScrollPositionUntilNextRender:s}=(0,o.a_)(),u=e=>{const n=e.currentTarget,i=l.indexOf(n),o=a[i].value;o!==t&&(s(n),r(o))},c=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:r})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{l.push(e)},onKeyDown:c,onClick:u,...r,className:(0,i.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function j({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function w(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,i.A)(a.G.tabs.container,"tabs-container",x.tabList),children:[(0,b.jsx)(y,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function k(e){const n=(0,v.A)();return(0,b.jsx)(w,{...e,children:p(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var r=t(18215);const i={tabItem:"tabItem_Ymn6"};var a=t(74848);function o({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(96540);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},32264:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>u,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"concepts/pulumi","title":"Pulumi","description":"Define your Defang services with Pulumi to integrate with other cloud resources.","source":"@site/docs/concepts/pulumi.md","sourceDirName":"concepts","slug":"/concepts/pulumi","permalink":"/docs/concepts/pulumi","draft":false,"unlisted":false,"editUrl":"https://github.com/DefangLabs/defang-docs/tree/main/docs/concepts/pulumi.md","tags":[],"version":"current","frontMatter":{"title":"Pulumi","description":"Define your Defang services with Pulumi to integrate with other cloud resources."},"sidebar":"docsSidebar","previous":{"title":"Projects","permalink":"/docs/concepts/projects"},"next":{"title":"Railpack","permalink":"/docs/concepts/railpack"}}');var i=t(74848),a=t(28453),o=t(11470),l=t(19365);const s={title:"Pulumi",description:"Define your Defang services with Pulumi to integrate with other cloud resources."},u="Pulumi",c={},d=[{value:"Install the Defang Pulumi Provider",id:"install-the-defang-pulumi-provider",level:2},{value:"When to Use the Defang Pulumi Provider",id:"when-to-use-the-defang-pulumi-provider",level:2},{value:"Example",id:"example",level:2},{value:"API",id:"api",level:2},{value:"<code>DefangService</code>",id:"defangservice",level:3},{value:"<code>DefangServiceArgs</code>",id:"defangserviceargs",level:3},{value:"<code>Platform</code>",id:"platform",level:3},{value:"<code>Protocol</code>",id:"protocol",level:3},{value:"<code>DeviceCapability</code>",id:"devicecapability",level:3},{value:"<code>NetworkName</code>",id:"networkname",level:3},{value:"<code>Network</code>",id:"network",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"pulumi",children:"Pulumi"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Pulumi support is currently only available for Defang Playground. We are working on support for Defang BYOC."})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.pulumi.com",children:"Pulumi"})," is a modern infrastructure-as-code toolkit that allows developers to use a programming language like Typescript to provision and manage cloud resources."]}),"\n",(0,i.jsxs)(n.p,{children:["Defang provides a Pulumi ",(0,i.jsx)(n.a,{href:"https://www.pulumi.com/docs/iac/concepts/resources/providers/",children:(0,i.jsx)(n.em,{children:"Provider"})})," written in Typescript which can be used to deploy Defang services alongside other Pulumi-managed infrastructure."]}),"\n",(0,i.jsx)(n.h2,{id:"install-the-defang-pulumi-provider",children:"Install the Defang Pulumi Provider"}),"\n",(0,i.jsxs)(n.p,{children:["To get started with Pulumi and Defang you will need to install the Defang provider in ",(0,i.jsx)(n.a,{href:"https://www.pulumi.com/learn/pulumi-fundamentals/create-a-pulumi-project/",children:"your Pulumi project"}),":"]}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(l.A,{value:"npm",label:"npm",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm i @defang-io/pulumi-defang\n"})})}),(0,i.jsx)(l.A,{value:"pnpm",label:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm i @defang-io/pulumi-defang\n"})})}),(0,i.jsx)(l.A,{value:"yarn",label:"yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn add @defang-io/pulumi-defang\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-the-defang-pulumi-provider",children:"When to Use the Defang Pulumi Provider"}),"\n",(0,i.jsxs)(n.p,{children:["The Defang Pulumi Provider is a good option for developers with more complex requirements than those supported by a ",(0,i.jsx)(n.a,{href:"/docs/concepts/compose",children:"Compose File"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"One reason to use the Defang Pulumi provider is if you wish to integrate your services with other cloud resources. This is particularly true if you need to configure your services dynamically as other cloud resources are being provisioned."}),"\n",(0,i.jsx)(n.p,{children:"Another reason would be if you want to deploy your services alongside cloud-specific resources, like a DynamoDB table, or an S3 bucket."}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"The following is a minimal example of a Pulumi program that defines a Defang service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import * as defang from "@defang-io/pulumi-defang/lib";\n\nconst service = new defang.DefangService("my-service", {\n    image: "strm/helloworld-http:latest",\n    ports: [{\n        target: 80,\n        mode: "ingress",\n        protocol: "http",\n    }],\n});\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"/docs/tutorials/deploy-using-pulumi",children:"Deploy using Pulumi"})," tutorial for more information about how to use it."]})}),"\n",(0,i.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,i.jsx)(n.h3,{id:"defangservice",children:(0,i.jsx)(n.code,{children:"DefangService"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"constructor(\n    name: string,\n    args: DefangServiceArgs,\n    opts?: pulumi.CustomResourceOptions\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"defangserviceargs",children:(0,i.jsx)(n.code,{children:"DefangServiceArgs"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface DefangServiceArgs {\n  /** the DNS name of the Defang Fabric service; defaults to the value of DEFANG_FABRIC or prod, if unset */\n  fabricDNS?: pulumi.Input<string>;\n  /** the name of the service; defaults to the name of the resource */\n  name?: pulumi.Input<string>;\n  /** the container image to deploy; required when no build configuration was provided */\n  image?: pulumi.Input<string>;\n  /** the platform to deploy to; defaults to "linux/amd64" */\n  platform?: pulumi.Input<Platform>;\n  /** which network the service is in, ie. whether the service requires a public IP or not; defaults to "private" (was: internal=true) */\n  networks?: { [key in NetworkName]?: Network };\n  /** the optional deployment configuration */\n  deploy?: pulumi.Input<Deploy>;\n  /** the ports to expose */\n  ports?: pulumi.Input<pulumi.Input<Port>[]>;\n  /** the environment variables to set; use `null` to mark at sensitive */\n  environment?: pulumi.Input<{ [key: string]: pulumi.Input<string> | null }>;\n  /** the secrets to expose as environment variables @deprecated use environment key with value `null` */\n  secrets?: pulumi.Input<pulumi.Input<Secret>[]>;\n  /** force deployment of the service even if nothing has changed */\n  forceNewDeployment?: pulumi.Input<boolean>;\n  /** the command to run; overrides the container image\'s CMD */\n  command?: pulumi.Input<pulumi.Input<string>[]>;\n  /** the optional build configuration; required when no image was provided */\n  build?: pulumi.Input<Build>;\n  /** the optional health-check test for the service */\n  healthcheck?: pulumi.Input<HealthCheck>;\n  /** the optional fully qualified domain name for the service; requires CNAME to the publicFqdn */\n  domainname?: pulumi.Input<string>;\n  /** experimental: mark this service as (managed) Redis */\n  x_redis?: pulumi.Input<unknown>;\n  /** experimental: mark this service as serving static files */\n  x_static_files?: pulumi.Input<StaticFiles>;\n  /** if true, this provider will wait for the service to reach a steady state before continuing */\n  waitForSteadyState?: pulumi.Input<boolean>;\n  /** the project to deploy the service to */\n  project?: pulumi.Input<string>;\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"platform",children:(0,i.jsx)(n.code,{children:"Platform"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'type Platform = "linux/arm64" | "linux/amd64" | "linux";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"protocol",children:(0,i.jsx)(n.code,{children:"Protocol"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'type Protocol = "tcp" | "udp" | "http" | "http2" | "grpc";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"devicecapability",children:(0,i.jsx)(n.code,{children:"DeviceCapability"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'type DeviceCapability = "gpu";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"networkname",children:(0,i.jsx)(n.code,{children:"NetworkName"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'type NetworkName = "private" | "public";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"network",children:(0,i.jsx)(n.code,{children:"Network"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type Network = { aliases?: string[] } | null;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);