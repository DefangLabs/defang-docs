"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[654],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var t=o(96540);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}},84930:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=o(74848),i=o(28453);const r={sidebar_position:100,description:"Deploy your Heroku Applications in your own Cloud Account with Defang"},s="Migrating from Heroku",a={id:"tutorials/migrating-from-heroku",title:"Migrating from Heroku",description:"Deploy your Heroku Applications in your own Cloud Account with Defang",source:"@site/docs/tutorials/migrating-from-heroku.md",sourceDirName:"tutorials",slug:"/tutorials/migrating-from-heroku",permalink:"/docs/tutorials/migrating-from-heroku",draft:!1,unlisted:!1,editUrl:"https://github.com/DefangLabs/defang-docs/tree/main/docs/tutorials/migrating-from-heroku.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100,description:"Deploy your Heroku Applications in your own Cloud Account with Defang"},sidebar:"docsSidebar",previous:{title:"Generate Project Outlines With AI",permalink:"/docs/tutorials/generate-new-code-using-ai"},next:{title:"Deploy Existing Containers",permalink:"/docs/tutorials/deploy-container-using-the-cli"}},l={},c=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Step 1 - Generating a Docker Compose file",id:"step-1---generating-a-docker-compose-file",level:2},{value:"Step 2 - Deploying to your cloud account",id:"step-2---deploying-to-your-cloud-account",level:2},{value:"Deploying to AWS",id:"deploying-to-aws",level:3},{value:"Deploying to GCP",id:"deploying-to-gcp",level:3},{value:"Step 3 - Migrating your data",id:"step-3---migrating-your-data",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"migrating-from-heroku",children:"Migrating from Heroku"}),"\n",(0,t.jsx)(n.p,{children:"This tutorial will guide you through the process of migrating your Heroku applications to your own cloud account with Defang. This will allow you to reduce cost, gain more control, and access to the complete range of available cloud services."}),"\n",(0,t.jsx)(n.h2,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/concepts/authentication",children:"A Defang Account"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/getting-started#install-the-defang-cli",children:"The Defang CLI"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://devcenter.heroku.com/articles/heroku-cli#install-the-heroku-cli",children:"The Heroku CLI (optional, but recommended)"})}),"\n",(0,t.jsxs)(n.li,{children:["Cloud Account Credentials","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-authentication.html",children:"AWS"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cloud.google.com/docs/authentication/set-up-adc-local-dev-environment",children:"GCP"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Do I need a Dockerfile?"})}),(0,t.jsxs)(n.p,{children:["No, Defang will use ",(0,t.jsx)(n.a,{href:"https://railpack.com/",children:"Railpack"})," to automatically build an OCI container for your application based on the source code and dependencies."]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Do I need a Docker Compose file?"})}),(0,t.jsx)(n.p,{children:"Defang does require a Docker Compose file to deploy your application, but you don't need to write one from scratch. Defang will automatically generate one for your Heroku application."})]}),"\n",(0,t.jsx)(n.h2,{id:"step-1---generating-a-docker-compose-file",children:"Step 1 - Generating a Docker Compose file"}),"\n",(0,t.jsx)(n.p,{children:"Navigate to your project's working directory:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ cd ~/w/vast-badlands\n$ ls\nGemfile\t\tProcfile\tRakefile\tbin\t\tconfig.ru\tlib\t\tpublic\t\ttest\t\tvendor\nGemfile.lock\tREADME.md\tapp\t\tconfig\t\tdb\t\tlog\t\tstorage\t\ttmp\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then run ",(0,t.jsx)(n.code,{children:"defang init"})," and select ",(0,t.jsx)(n.code,{children:"Migrate from heroku"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ defang init\n? How would you like to start?  [Use arrows to move, type to filter]\n  Generate with AI\n  Clone a sample\n> Migrate from Heroku\n"})}),"\n",(0,t.jsxs)(n.p,{children:["A web browser may open, prompting you to login to Defang. Then, if you have the ",(0,t.jsx)(n.code,{children:"heroku"})," CLI installed, you may be prompted to login with Heroku. Defang will delegate to the ",(0,t.jsx)(n.code,{children:"heroku"})," CLI to create an authentication token so that it can access information about your deployment. The token ",(0,t.jsx)(n.code,{children:"defang"})," creates will only be valid for 5 minutes."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What if I don't have the Heroku CLI installed?"}),"\n",(0,t.jsx)(n.code,{children:"defang"})," will prompt you for an auth token. You can paste it into the prompt after ",(0,t.jsx)(n.a,{href:"https://dashboard.heroku.com/account/applications/authorizations/new",children:"creating one in the Heroku Dashboard"}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:["At this point, ",(0,t.jsx)(n.code,{children:"defang"})," will fetch a list of your Heroku applications and prompt you to select the one you would like to migrate."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ defang init\n? How would you like to start? Migrate from Heroku\n * Ok, let's create a compose file for your existing deployment.\n * The Heroku CLI is installed, we'll use it to generate a short-lived authorization token\n? Select the Heroku application to use as a source:  [Use arrows to move, type to filter]\n> vast-badlands-staging\n  vast-badlands-production\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then, ",(0,t.jsx)(n.code,{children:"defang"})," will request some information about your application from the Heroku API. This information will be used to generate a ",(0,t.jsx)(n.code,{children:"compose.yaml"})," file which can then be deployed with Defang."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"defang init\n? How would you like to start? Migrate from heroku\n * Ok, let's create a compose file for your existing deployment.\n * The Heroku CLI is installed, we'll use it to generate a short-lived authorization token\n? Select the Heroku application to use as a source: vast-badlands-production\n * Collecting information about \"vast-badlands-production\"...\n * Generating compose file...\n * Compose file written to compose.yaml\n\nCheck the files in your favorite editor.\nTo deploy this project, run\n\n  defang compose up\n"})}),"\n",(0,t.jsxs)(n.p,{children:["At this point, ",(0,t.jsx)(n.code,{children:"defang"})," will have generated a ",(0,t.jsx)(n.code,{children:"compose.yaml"})," file that describes your application and its services. You can review this file in your favorite text editor."]}),"\n",(0,t.jsxs)(n.p,{children:["The application I used had a single ",(0,t.jsx)(n.code,{children:"web"})," dyno:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ heroku ps -a vast-badlands-production\n\n=== web (Eco): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\n"})}),"\n",(0,t.jsx)(n.p,{children:"And a single PostgreSQL database:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"heroku addons -a vast-badlands-production\n\n Add-on                                     Plan        Price        Max price State\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n heroku-postgresql (postgresql-rosy-12345) essential-0 ~$0.007/hour $5/month  created\n  \u2514\u2500 as DATABASE\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"compose.yaml"})," file that ",(0,t.jsx)(n.code,{children:"defang"})," generated looks like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'services:\n  postgres:\n    image: postgres:17.4\n    environment:\n      POSTGRES_DB: eb631mzx93pn27\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD:\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U $POSTGRES_USER"]\n    x-defang-postgres: "true"\n\n  web:\n    build:\n      context: .\n    command:\n      - bin/rails server -p $PORT -e $RAILS_ENV\n    ports:\n      - "5000:5000"\n    environment:\n      DATABASE_URL: postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@postgres:5432/$POSTGRES_DB\n      LANG: en_US.UTF-8\n      RACK_ENV: production\n      RAILS_ENV: production\n      RAILS_LOG_TO_STDOUT: enabled\n      RAILS_SERVE_STATIC_FILES: enabled\n      SECRET_KEY_BASE:\n      PORT: 5000\n      POSTGRES_PASSWORD: $POSTGRES_PASSWORD\n    depends_on:\n      postgres:\n        condition: service_healthy\n    deploy:\n      resources:\n        limits:\n          cpus: \'1\'\n          memory: 512M\n\n  release:\n    build:\n      context: .\n    command:\n      - bin/rails db:migrate\n    environment:\n      DATABASE_URL: postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@postgres:5432/$POSTGRES_DB\n      RAILS_ENV: production\n      SECRET_KEY_BASE:\n    depends_on:\n      postgres:\n        condition: service_healthy\n    deploy:\n      resources:\n        limits:\n          cpus: \'1\'\n          memory: 512M\n    restart: "no"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"step-2---deploying-to-your-cloud-account",children:"Step 2 - Deploying to your cloud account"}),"\n",(0,t.jsx)(n.p,{children:"Now all you need to do is deploy your application to the cloud."}),"\n",(0,t.jsx)(n.h3,{id:"deploying-to-aws",children:"Deploying to AWS"}),"\n",(0,t.jsxs)(n.p,{children:["If you're deploying to AWS, you'll need to invoke ",(0,t.jsx)(n.code,{children:"defang compose up"})," with your AWS access credentials in the environment:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"AWS_REGION=us-west-2 AWS_PROFILE=default defang compose up --provider aws\n"})}),"\n",(0,t.jsxs)(n.p,{children:["See our full tutorial on ",(0,t.jsx)(n.a,{href:"/docs/tutorials/deploy-to-aws",children:"deploying to AWS"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"deploying-to-gcp",children:"Deploying to GCP"}),"\n",(0,t.jsx)(n.p,{children:"GCP support for deployments without Dockerfiles coming soon."}),"\n",(0,t.jsx)(n.h2,{id:"step-3---migrating-your-data",children:"Step 3 - Migrating your data"}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If you need help with your migration, please reach out to our support team on ",(0,t.jsx)(n.a,{href:"https://s.defang.io/discord",children:"Discord"}),"."]})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);