"use strict";(self.webpackChunkdefang_docs=self.webpackChunkdefang_docs||[]).push([[4066],{2803:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var s=o(74848),t=o(28453);const r={title:"One-off Jobs",description:"Defang enables you to run one-off jobs during your deployment workflow."},d="One-off Jobs",i={id:"concepts/one-off-jobs",title:"One-off Jobs",description:"Defang enables you to run one-off jobs during your deployment workflow.",source:"@site/docs/concepts/one-off-jobs.md",sourceDirName:"concepts",slug:"/concepts/one-off-jobs",permalink:"/docs/concepts/one-off-jobs",draft:!1,unlisted:!1,editUrl:"https://github.com/DefangLabs/defang-docs/tree/main/docs/concepts/one-off-jobs.md",tags:[],version:"current",frontMatter:{title:"One-off Jobs",description:"Defang enables you to run one-off jobs during your deployment workflow."},sidebar:"docsSidebar",previous:{title:"Observability",permalink:"/docs/concepts/observability"},next:{title:"Portal",permalink:"/docs/concepts/portal"}},l={},c=[{value:"When should one-off jobs be used?",id:"when-should-one-off-jobs-be-used",level:2},{value:"How to configure one-off jobs",id:"how-to-configure-one-off-jobs",level:2},{value:"How to specify job dependencies",id:"how-to-specify-job-dependencies",level:3},{value:"How do one-off jobs work under the hood?",id:"how-do-one-off-jobs-work-under-the-hood",level:2},{value:"Supported Providers",id:"supported-providers",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"one-off-jobs",children:"One-off Jobs"}),"\n",(0,s.jsx)(n.p,{children:"Defang enables you to run one-off jobs during your deployment workflow. One-off jobs are commands that run at specific points in the deployment process, such as after your database is ready but before your application starts."}),"\n",(0,s.jsx)(n.p,{children:"One-off jobs are run a single time, and failure to run a one-off job will cause the entire deployment to fail."}),"\n",(0,s.jsx)(n.h2,{id:"when-should-one-off-jobs-be-used",children:"When should one-off jobs be used?"}),"\n",(0,s.jsx)(n.p,{children:"One-off jobs are useful for running commands that need to be executed before your application starts. Common use cases include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database migrations"}),"\n",(0,s.jsx)(n.li,{children:"Warming or cleaning caches"}),"\n",(0,s.jsx)(n.li,{children:"Running build scripts"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-configure-one-off-jobs",children:"How to configure one-off jobs"}),"\n",(0,s.jsxs)(n.p,{children:["One-off jobs can be configured in your ",(0,s.jsx)(n.code,{children:"compose.yaml"})," file as services with a ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/reference/compose-file/services/#restart",children:"Restart Policy"})," set to ",(0,s.jsx)(n.code,{children:'"no"'}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In the example below, we define a one-off job called ",(0,s.jsx)(n.code,{children:"release"})," that runs a script called ",(0,s.jsx)(n.code,{children:"release.sh"}),". This job will run once during the deployment process. It will be run concurrently with the ",(0,s.jsx)(n.code,{children:"web"})," service."]}),"\n",(0,s.jsxs)("table",{width:"100%",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)("code",{children:"compose.yaml"})}),(0,s.jsx)("th",{children:"Workflow"})]})}),(0,s.jsx)("tbody",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{valign:"top",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'services:\n  app:\n    build: .\n    ports:\n      - "80:80"\n\n  release:\n    build: .\n    command: ["./release.sh"]\n    restart: "no"\n'})})}),(0,s.jsx)("td",{valign:"top",children:(0,s.jsx)(n.mermaid,{value:'flowchart LR\n  subgraph workspace["Deployment Workflow"]\n    deployment_start\n    app\n    release\n    deployment_complete\n\n    deployment_start --\x3e app\n    deployment_start --\x3e release\n    app --\x3e deployment_complete\n    release --\x3e deployment_complete\n  end'})})]})})]}),"\n",(0,s.jsx)(n.h3,{id:"how-to-specify-job-dependencies",children:"How to specify job dependencies"}),"\n",(0,s.jsxs)(n.p,{children:["You can specify when the job should run by using ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/reference/compose-file/services/#depends_on",children:(0,s.jsx)(n.code,{children:"depends_on"})})," to define dependencies on other services. For example, when running database migrations, you would typically want to ensure that the database service is ready before executing the migration job."]}),"\n",(0,s.jsx)(n.p,{children:"Here is an example configuration for a one-off job that runs database migrations after the database service is ready:"}),"\n",(0,s.jsxs)("table",{width:"100%",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)("code",{children:"compose.yaml"})}),(0,s.jsx)("th",{children:"Workflow"})]})}),(0,s.jsx)("tbody",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{valign:"top",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'services:\n  db:\n    image: postgres:latest\n\n  migrate:\n    build: .\n    command: ["./migrate.sh"]\n    depends_on:\n      - db\n    restart: "no"\n\n  web:\n    build: .\n    ports:\n      - "80:80"\n    depends_on:\n      - migrate\n'})})}),(0,s.jsx)("td",{valign:"top",children:(0,s.jsx)(n.mermaid,{value:'flowchart LR\n  subgraph workspace["Deployment Workflow"]\n    deployment_start\n    db\n    web\n    migrate\n    deployment_complete\n\n    deployment_start --\x3e db\n    db --\x3e migrate\n    migrate --\x3e web\n    web --\x3e deployment_complete\n  end'})})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"how-do-one-off-jobs-work-under-the-hood",children:"How do one-off jobs work under the hood?"}),"\n",(0,s.jsx)(n.p,{children:"One off jobs are deployed as temporary containers on the same infrastructure as your main services. They are deployed as separate containers to ensure that they do not interfere with the main application services, so resources can be configured independently. They will share the same network and security groups as your other services, allowing them to communicate with your application and database services as needed."}),"\n",(0,s.jsx)(n.h3,{id:"supported-providers",children:"Supported Providers"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Provider"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"Release Task Support"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Playground"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"AWS"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DigitalOcean"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"GCP"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>d,x:()=>i});var s=o(96540);const t={},r=s.createContext(t);function d(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);