<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/deploying-from-github-actions/to-aws" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Deploying to AWS | Defang</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.defang.io/img/defang-social-card-2.png"><meta data-rh="true" name="twitter:image" content="https://docs.defang.io/img/defang-social-card-2.png"><meta data-rh="true" property="og:url" content="https://docs.defang.io/docs/tutorials/deploying-from-github-actions/to-aws"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying to AWS | Defang"><meta data-rh="true" name="description" content="Using the Defang GitHub Action to deploy your project to AWS from your CI/CD pipeline."><meta data-rh="true" property="og:description" content="Using the Defang GitHub Action to deploy your project to AWS from your CI/CD pipeline."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.defang.io/docs/tutorials/deploying-from-github-actions/to-aws"><link data-rh="true" rel="alternate" href="https://docs.defang.io/docs/tutorials/deploying-from-github-actions/to-aws" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.defang.io/docs/tutorials/deploying-from-github-actions/to-aws" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://O3VFCOSSZ6-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deploying From Github Actions","item":"https://docs.defang.io/docs/category/deploying-from-github-actions"},{"@type":"ListItem","position":2,"name":"Deploying to AWS","item":"https://docs.defang.io/docs/tutorials/deploying-from-github-actions/to-aws"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Defang" href="/opensearch.xml">



<link rel="icon" href="/img/tab_icon.svg">
<script src="/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.44d27d3f.css">
<script src="/assets/js/runtime~main.438d552a.js" defer="defer"></script>
<script src="/assets/js/main.cd485c01.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://defang.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/defang-logo.svg" alt="Defang Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/defang-logo.svg" alt="Defang Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Defang Home</b></a><a class="navbar__item navbar__link" href="/docs/intro">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/tutorials">Tutorials</a><a class="navbar__item navbar__link" href="/docs/concepts">Concepts</a><a class="navbar__item navbar__link" href="/docs/providers">Providers</a><a class="navbar__item navbar__link" href="/docs/cli">CLI</a><a href="https://defang.io/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://defang.io/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Samples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar__item-get_started" href="/docs/intro/getting-started">Get Started</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials"><span title="Defang Tutorials" class="linkLabel_WmDU">Defang Tutorials</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/tutorials/deploy-openai-apps"><span title="Deploy OpenAI Apps on Managed LLMs" class="categoryLinkLabel_W154">Deploy OpenAI Apps on Managed LLMs</span></a><button aria-label="Expand sidebar category &#x27;Deploy OpenAI Apps on Managed LLMs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/adding-custom-one-click-deploy"><span title="Adding Custom 1-Click Deploy to Your App" class="linkLabel_WmDU">Adding Custom 1-Click Deploy to Your App</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/configure-environment-variables"><span title="Configure Environment Variables" class="linkLabel_WmDU">Configure Environment Variables</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-container-using-the-cli"><span title="Deploy Existing Containers" class="linkLabel_WmDU">Deploy Existing Containers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-to-aws"><span title="Deploy to AWS" class="linkLabel_WmDU">Deploy to AWS</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-to-digitalocean"><span title="Deploy to DigitalOcean" class="linkLabel_WmDU">Deploy to DigitalOcean</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-to-gcp"><span title="Deploy to GCP" class="linkLabel_WmDU">Deploy to GCP</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-to-playground"><span title="Deploy to Playground" class="linkLabel_WmDU">Deploy to Playground</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-to-your-cloud"><span title="Deploy to Your Own Cloud" class="linkLabel_WmDU">Deploy to Your Own Cloud</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-using-pulumi"><span title="Deploy Using Pulumi" class="linkLabel_WmDU">Deploy Using Pulumi</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploy-with-gpu"><span title="Deploy a GPU-Powered Application" class="linkLabel_WmDU">Deploy a GPU-Powered Application</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/category/deploying-from-github-actions"><span title="Deploying From Github Actions" class="categoryLinkLabel_W154">Deploying From Github Actions</span></a><button aria-label="Collapse sidebar category &#x27;Deploying From Github Actions&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/deploying-from-github-actions/to-aws"><span title="Deploying to AWS" class="linkLabel_WmDU">Deploying to AWS</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/deploying-from-github-actions/to-gcp"><span title="Deploying to GCP" class="linkLabel_WmDU">Deploying to GCP</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploying-from-github-actions"><span title="Deploying from GitHub Actions" class="linkLabel_WmDU">Deploying from GitHub Actions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/deploying-with-the-defang-mcp-server"><span title="Deploying with the Defang MCP Server" class="linkLabel_WmDU">Deploying with the Defang MCP Server</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/estimating-aws-deployment-costs"><span title="Estimating AWS Deployment Costs" class="linkLabel_WmDU">Estimating AWS Deployment Costs</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/estimating-gcp-deployment-costs"><span title="Estimating GCP Deployment Costs" class="linkLabel_WmDU">Estimating GCP Deployment Costs</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/generate-new-code-using-ai"><span title="Generate Project Outlines With AI" class="linkLabel_WmDU">Generate Project Outlines With AI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/migrating-from-heroku"><span title="Migrating from Heroku" class="linkLabel_WmDU">Migrating from Heroku</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/monitoring-your-services"><span title="Monitoring Your Services" class="linkLabel_WmDU">Monitoring Your Services</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/scaling-your-services"><span title="Scaling Your Services" class="linkLabel_WmDU">Scaling Your Services</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/setting_up_your_aws_account"><span title="Setting Up Your AWS Account" class="linkLabel_WmDU">Setting Up Your AWS Account</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/setting_up_your_gcp_account"><span title="Setting Up Your GCP Account" class="linkLabel_WmDU">Setting Up Your GCP Account</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/updating-your-services"><span title="Updating Your Services" class="linkLabel_WmDU">Updating Your Services</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/use-your-own-domain-name"><span title="How to Use Your Own Domain" class="linkLabel_WmDU">How to Use Your Own Domain</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/using-codespaces-gitpod"><span title="Using Codespaces and Gitpod" class="linkLabel_WmDU">Using Codespaces and Gitpod</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/using-one-click-deploy"><span title="Using 1-Click Deploy" class="linkLabel_WmDU">Using 1-Click Deploy</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/deploying-from-github-actions"><span>Deploying From Github Actions</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Deploying to AWS</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying to AWS from GitHub Actions</h1></header>
<p>This tutorial will show you how to use the <a href="https://github.com/DefangLabs/defang-github-action" target="_blank" rel="noopener noreferrer">Defang GitHub Action</a> to deploy your project to AWS from your GitHub Actions workflow.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<ul>
<li><a href="/docs/concepts/authentication">A Defang Account</a></li>
<li><a href="https://docs.github.com/en/get-started/quickstart/create-a-repo" target="_blank" rel="noopener noreferrer">A GitHub Repo</a></li>
<li><a href="https://aws.amazon.com" target="_blank" rel="noopener noreferrer">An AWS Account</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The Defang GitHub Action uses OpenID Connect (OIDC) to securely authenticate with your AWS account without storing long-lived credentials. This requires:</p>
<ol>
<li>An OIDC identity provider in your AWS account that trusts GitHub Actions</li>
<li>An IAM role that GitHub Actions can assume</li>
<li>A GitHub Actions workflow configured with the correct permissions</li>
</ol>
<p>The easiest way to set this up is using the <strong>Defang Portal</strong>, which automates the AWS configuration with a single CloudFormation stack. Alternatively, you can <a href="#option-2-manual-aws-configuration">configure AWS manually</a>.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-using-the-defang-portal-recommended">Option 1: Using the Defang Portal (Recommended)<a href="#option-1-using-the-defang-portal-recommended" class="hash-link" aria-label="Direct link to Option 1: Using the Defang Portal (Recommended)" title="Direct link to Option 1: Using the Defang Portal (Recommended)" translate="no">​</a></h2>
<p>The Defang Portal provides a streamlined setup experience that creates all required AWS resources automatically.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---configure-aws-via-the-portal">Step 1 - Configure AWS via the Portal<a href="#step-1---configure-aws-via-the-portal" class="hash-link" aria-label="Direct link to Step 1 - Configure AWS via the Portal" title="Direct link to Step 1 - Configure AWS via the Portal" translate="no">​</a></h3>
<ol>
<li>Go to <a href="https://portal.defang.io" target="_blank" rel="noopener noreferrer">portal.defang.io</a> and log in</li>
<li>Navigate to <strong>Clouds</strong> → <strong>AWS</strong></li>
<li>Select your GitHub organization</li>
<li>Choose whether to allow <strong>all repos</strong> or <strong>private repos only</strong></li>
<li>Enter your AWS Account ID and select your preferred region</li>
<li>Click <strong>Launch CloudFormation</strong> to open AWS CloudFormation with pre-filled parameters</li>
<li>In AWS CloudFormation, review the stack and click <strong>Create stack</strong></li>
</ol>
<p>This creates:</p>
<ul>
<li>An OIDC identity provider for GitHub Actions</li>
<li>An IAM role named <code>defang-cd-CIRole</code> with the necessary trust policy</li>
<li>Other resources needed for Defang deployments</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---create-your-github-actions-workflow">Step 2 - Create your GitHub Actions workflow<a href="#step-2---create-your-github-actions-workflow" class="hash-link" aria-label="Direct link to Step 2 - Create your GitHub Actions workflow" title="Direct link to Step 2 - Create your GitHub Actions workflow" translate="no">​</a></h3>
<p>In your GitHub repository, create a new file at <code>.github/workflows/deploy.yml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy with Defang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contents</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write  </span><span class="token comment" style="color:#999988;font-style:italic"># Required for OIDC authentication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout Repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DefangLabs/defang</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># stack: production # optional, but recommended to use stacks https://docs.defang.io/docs/concepts/stacks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">AWS_REGION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Change to your preferred region</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">AWS_ROLE_ARN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">YOUR_AWS_ACCOUNT_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">role/defang</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">CIRole</span><br></span></code></pre></div></div>
<p>Replace:</p>
<ul>
<li><code>YOUR_AWS_ACCOUNT_ID</code> with your 12-digit AWS account ID</li>
<li><code>us-west-2</code> with your preferred AWS region (must match the region you selected in the Portal)</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The Defang CLI handles OIDC authentication internally when <code>AWS_ROLE_ARN</code> is set. You don&#x27;t need the <code>aws-actions/configure-aws-credentials</code> action.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---configure-secrets-if-needed">Step 3 - Configure secrets (if needed)<a href="#step-3---configure-secrets-if-needed" class="hash-link" aria-label="Direct link to Step 3 - Configure secrets (if needed)" title="Direct link to Step 3 - Configure secrets (if needed)" translate="no">​</a></h3>
<p>If your application requires secrets or configuration values, add them to your workflow:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DefangLabs/defang</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config-env-vars</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      DATABASE_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      API_KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">AWS_REGION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">AWS_ROLE_ARN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">YOUR_AWS_ACCOUNT_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">role/defang</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">CIRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.DATABASE_URL </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">API_KEY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.API_KEY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="important-stack-configuration-files">Important: Stack Configuration Files<a href="#important-stack-configuration-files" class="hash-link" aria-label="Direct link to Important: Stack Configuration Files" title="Direct link to Important: Stack Configuration Files" translate="no">​</a></h3>
<p>If you have a <code>.defang/</code> directory with stack configuration files (e.g., <code>.defang/production</code>), make sure they don&#x27;t include <code>AWS_PROFILE</code>. The profile setting is for local development only and will cause errors in CI/CD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># .defang/production - CI/CD compatible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS_REGION=&quot;us-west-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFANG_PROVIDER=&quot;aws&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># .defang/production - NOT CI/CD compatible (will fail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS_PROFILE=&quot;my-local-profile&quot;  # Remove this line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS_REGION=&quot;us-west-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFANG_PROVIDER=&quot;aws&quot;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-manual-aws-configuration">Option 2: Manual AWS Configuration<a href="#option-2-manual-aws-configuration" class="hash-link" aria-label="Direct link to Option 2: Manual AWS Configuration" title="Direct link to Option 2: Manual AWS Configuration" translate="no">​</a></h2>
<p>If you prefer to configure AWS manually or need more control over the setup, follow the steps below.</p>
<p>The following steps will guide you through setting up a GitHub Actions workflow that can assume a role in your AWS account using OpenID Connect (OIDC) and deploy your project using the Defang GitHub Action. The role which will be assumed must have a trust relationship with an OIDC identity provider (IdP) for GitHub Actions, and that trust relationship must be configured to allow the specific repository and branch to assume the role. This ultimately allows the GitHub Actions workflow to securely access your AWS resources without needing to store long-lived AWS credentials in your repository.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---identify-your-aws-account-id">Step 1 - Identify your AWS Account ID<a href="#step-1---identify-your-aws-account-id" class="hash-link" aria-label="Direct link to Step 1 - Identify your AWS Account ID" title="Direct link to Step 1 - Identify your AWS Account ID" translate="no">​</a></h3>
<p>To configure the GitHub Action to assume a role in your AWS account, you&#x27;ll need your AWS Account ID.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AWS CLI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS Dashboard</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws sts get-caller-identity --query Account --output text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">123456789012 # for example</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ol>
<li>Go to the <a href="https://aws.amazon.com/console/" target="_blank" rel="noopener noreferrer">AWS Management Console</a>.</li>
<li>In the top right corner, click on your account name or number.</li>
<li>Your AWS Account ID will be displayed in the dropdown menu.</li>
</ol></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---create-an-aws-identity-provider-for-github-actions">Step 2 - Create an AWS Identity Provider for GitHub Actions<a href="#step-2---create-an-aws-identity-provider-for-github-actions" class="hash-link" aria-label="Direct link to Step 2 - Create an AWS Identity Provider for GitHub Actions" title="Direct link to Step 2 - Create an AWS Identity Provider for GitHub Actions" translate="no">​</a></h3>
<p>You will need to create a new OIDC Identity Provider in AWS to enable GitHub Actions to assume roles in your AWS account.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AWS CLI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS Dashboard</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Using the AWS CLI:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws iam create-open-id-connect-provider --client-id-list sts.amazonaws.com --url https://token.actions.githubusercontent.com</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Using the AWS Dashboard:</p><ol>
<li>Go to the <a href="https://console.aws.amazon.com/iam/home#/roles" target="_blank" rel="noopener noreferrer">AWS IAM Console</a>.</li>
<li>Click on &quot;Identity providers&quot; in the left sidebar.</li>
<li>Click on &quot;Add provider&quot;.</li>
<li>Choose &quot;OIDC&quot; as the provider type.</li>
<li>For the provider URL, enter <code>https://token.actions.githubusercontent.com</code>.</li>
<li>For the audience, enter <code>sts.amazonaws.com</code>.</li>
<li>Click &quot;Add provider&quot;.</li>
</ol></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---create-a-deployer-role-with-trust-relationship-for-github-actions">Step 3 - Create a deployer role with trust relationship for GitHub Actions<a href="#step-3---create-a-deployer-role-with-trust-relationship-for-github-actions" class="hash-link" aria-label="Direct link to Step 3 - Create a deployer role with trust relationship for GitHub Actions" title="Direct link to Step 3 - Create a deployer role with trust relationship for GitHub Actions" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AWS CLI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS Dashboard</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Using the AWS CLI:</p><ol>
<li>Create a trust policy document</li>
</ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; deployer-policy.json &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Action&quot;: &quot;*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Resource&quot;: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Sid&quot;: &quot;OidcForGitHub&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Federated&quot;: &quot;arn:aws:iam::YOUR_AWS_ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Action&quot;: &quot;sts:AssumeRoleWithWebIdentity&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Condition&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;StringLike&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;token.actions.githubusercontent.com:sub&quot;: &quot;repo:YOUR_REPO_OWNER/YOUR_REPO_NAME:ref:refs/heads/YOUR_BRANCH_NAME&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;StringEquals&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;token.actions.githubusercontent.com:aud&quot;: &quot;sts.amazonaws.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div><ol start="2">
<li>Edit the <code>deployer-policy.json</code> file to replace the following placeholders:</li>
</ol><ul>
<li><code>YOUR_AWS_ACCOUNT_ID</code> replace this with your actual AWS Account ID</li>
<li><code>YOUR_REPO_OWNER</code> your GitHub username or organization name (e.g., <code>ACMELabs</code>)</li>
<li><code>YOUR_REPO_NAME</code> your GitHub repository name (e.g., <code>my-project</code>)</li>
<li><code>YOUR_BRANCH_NAME</code> the branch you want to deploy from (e.g., <code>main</code>). If you want to allow multiple branches, you can use a wildcard like <code>*</code></li>
</ul><ol start="3">
<li>Create a deployer role</li>
</ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws iam create-role --role-name deployer --assume-role-policy-document file://deployer-policy.json</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Using the AWS Dashboard:</p><ol>
<li>Navigate to <a href="https://console.aws.amazon.com/iam/home#/roles" target="_blank" rel="noopener noreferrer">AWS IAM Console</a>.</li>
<li>Click on &quot;Create role&quot;.</li>
<li>Select &quot;Web identity&quot; as the trusted entity type.</li>
<li>For the identity provider, select the OIDC provider you created in the previous step.</li>
<li>For the audience, enter <code>sts.amazonaws.com</code>.</li>
<li>For the GitHub organization, enter your GitHub username or organization name (e.g., <code>ACMELabs</code>).</li>
<li>For the GitHub repository, enter your GitHub repository name (e.g., <code>my-project</code>).</li>
<li>For the GitHub branch, enter the branch you want to deploy from (e.g., <code>main</code>). If you want to allow multiple branches, you can use a wildcard like <code>*</code>.</li>
<li>Click &quot;Next&quot;.</li>
<li>Select the <code>AdministratorAccess</code> policy to attach to the role.</li>
<li>Click &quot;Next&quot;.</li>
<li>For the role name, enter <code>deployer</code>.</li>
<li>For the role description, enter &quot;This role is assumed by GitHub Actions when deploying with Defang&quot;.</li>
<li>Click &quot;Create role&quot;.</li>
</ol></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4---create-a-new-github-actions-workflow">Step 4 - Create a new GitHub Actions workflow<a href="#step-4---create-a-new-github-actions-workflow" class="hash-link" aria-label="Direct link to Step 4 - Create a new GitHub Actions workflow" title="Direct link to Step 4 - Create a new GitHub Actions workflow" translate="no">​</a></h3>
<p>In your GitHub repository, create a new file at <code>.github/workflows/deploy.yml</code> with the following content:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy with Defang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main  </span><span class="token comment" style="color:#999988;font-style:italic"># Change this to your default branch if it&#x27;s not &#x27;main&#x27;, this must match the branch you specified in the deployer role&#x27;s trust relationship.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contents</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Configure AWS Credentials for CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aws</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">actions/configure</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">credentials@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">aws-region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Replace with your AWS Account ID and the name of the role which we previously created.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">role-to-assume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">iam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">123456789012</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">role/deployer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout Repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DefangLabs/defang</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aws&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">stack</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mystack&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;affordable&quot;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Full documentation for configuring AWS can be found in the <a href="https://github.com/DefangLabs/defang-github-action" target="_blank" rel="noopener noreferrer">Defang GitHub Action repository</a>.</p></div></div>
<p>Now you have configured a GitHub Actions workflow that uses the Defang GitHub Action to deploy your project to AWS securely using OIDC and short-lived credentials. Whenever you push to the specified branch, the workflow will run and deploy your project using the permissions granted to the <code>deployer</code> role in your AWS account.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/DefangLabs/defang-docs/tree/main/docs/tutorials/deploying-from-github-actions/to-aws.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/deploying-from-github-actions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploying From Github Actions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/deploying-from-github-actions/to-gcp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploying to GCP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#option-1-using-the-defang-portal-recommended" class="table-of-contents__link toc-highlight">Option 1: Using the Defang Portal (Recommended)</a><ul><li><a href="#step-1---configure-aws-via-the-portal" class="table-of-contents__link toc-highlight">Step 1 - Configure AWS via the Portal</a></li><li><a href="#step-2---create-your-github-actions-workflow" class="table-of-contents__link toc-highlight">Step 2 - Create your GitHub Actions workflow</a></li><li><a href="#step-3---configure-secrets-if-needed" class="table-of-contents__link toc-highlight">Step 3 - Configure secrets (if needed)</a></li><li><a href="#important-stack-configuration-files" class="table-of-contents__link toc-highlight">Important: Stack Configuration Files</a></li></ul></li><li><a href="#option-2-manual-aws-configuration" class="table-of-contents__link toc-highlight">Option 2: Manual AWS Configuration</a><ul><li><a href="#step-1---identify-your-aws-account-id" class="table-of-contents__link toc-highlight">Step 1 - Identify your AWS Account ID</a></li><li><a href="#step-2---create-an-aws-identity-provider-for-github-actions" class="table-of-contents__link toc-highlight">Step 2 - Create an AWS Identity Provider for GitHub Actions</a></li><li><a href="#step-3---create-a-deployer-role-with-trust-relationship-for-github-actions" class="table-of-contents__link toc-highlight">Step 3 - Create a deployer role with trust relationship for GitHub Actions</a></li><li><a href="#step-4---create-a-new-github-actions-workflow" class="table-of-contents__link toc-highlight">Step 4 - Create a new GitHub Actions workflow</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sections</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/providers">Providers</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cli">CLI Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://defang.io/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ask">Ask Defang</a></li><li class="footer__item"><a href="https://defang.io/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item">Samples<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/DefangLabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://s.defang.io/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/DefangLabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/defang/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@DefangLabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>